@using Customers.Web.Models
@model PagedList<Customer>
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@{
    ViewBag.Title = "Customers";
}
@if (Request.IsAuthenticated && (User.IsInRole(RoleNames.Administrator) || User.IsInRole(RoleNames.Manager)))
{
    <p>
        @Html.ActionLink("Create customer", "Create", "Customers", new { @class = "btn btn-default" })
    </p>
}

@Html.LabelFor(model => model.Stats)
@Html.DisplayFor(model => model.Stats)

@Html.Partial("_SearchPartial")

@{
    var prevDisabled = !Model.HasPreviousPage ? "disabled" : "";
    var nextDisabled = !Model.HasNextPage ? "disabled" : "";
}
Page @(Model.TotalPages < Model.PageIndex ? 0 : Model.PageIndex) of @Model.TotalPages

    <table class="table">
        <tr>
            <th>
                @Html.CheckBoxFor(p => p.SelectAll)
            </th>
            <th>
                @Html.ActionLink(Html.DisplayNameFor(p => p.FirstOrDefault().Login).ToHtmlString(), "Index", "Customers", new { sortOrder = ViewBag.LoginSortParm }, new { sortOrder = ViewBag.LoginSortParm })
            </th>
            <th>
                @Html.ActionLink(Html.DisplayNameFor(p => p.FirstOrDefault().FullName).ToHtmlString(), "Index", "Customers", new {sortOrder = ViewBag.NameSortParm}, new {sortOrder = ViewBag.NameSortParm})
            </th>
            <th>
                @Html.ActionLink(Html.DisplayNameFor(p => p.FirstOrDefault().Email).ToHtmlString(), "Index", "Customers", new { sortOrder = ViewBag.EmailSortParm }, new { sortOrder = ViewBag.EmailSortParm })
            </th>
            <th>
                @Html.ActionLink(Html.DisplayNameFor(p => p.FirstOrDefault().PhoneNumber).ToHtmlString(), "Index", "Customers", new { sortOrder = ViewBag.PhoneSortParm }, new { sortOrder = ViewBag.PhoneSortParm })                
            </th>
            <th>
                @Html.DisplayNameFor(p => p.FirstOrDefault().IsActive)
            </th>
            <th>
                Edit/Delete
            </th>
        </tr>

        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.CheckBoxFor(modelItem => item.IsChecked)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Login)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.FullName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Email)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.PhoneNumber)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.IsActive)
                </td>
                <td>
                    @Html.ActionLink("Edit", "Edit", new {id = item.Id}) |
                    @Html.ActionLink("Delete", "Delete", new {id = item.Id})
                </td>
            </tr>
        }
        <tr>
            <td colspan="6">
            </td>
            <td>
                @Html.ActionLink("Prev", "Index", "Customers",
                    new {sortOrder = ViewBag.CurrentSort, page = Model.PageIndex - 1, currentFilter = ViewBag.CurrentFilter, @class = $"btn btn-default {prevDisabled} btn"},
                    new {sortOrder = ViewBag.CurrentSort, page = Model.PageIndex - 1, currentFilter = ViewBag.CurrentFilter, @class = $"btn btn-default {prevDisabled} btn"})

            </td>
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                var isDisabled = Model.PageIndex == i ? "disabled" : "";
                <td>
                    @Html.ActionLink(i.ToString(), "Index", "Customers",
                        new {sortOrder = ViewBag.CurrentSort, page = i, currentFilter = ViewBag.CurrentFilter, @class = $"btn btn-default {isDisabled} btn"},
                        new {sortOrder = ViewBag.CurrentSort, page = i, currentFilter = ViewBag.CurrentFilter, @class = $"btn btn-default {isDisabled} btn"})
                </td>
            }
            <td>
                @Html.ActionLink("Next", "Index", "Customers",
                    new {sortOrder = ViewBag.CurrentSort, page = Model.PageIndex + 1, currentFilter = ViewBag.CurrentFilter, @class = $"btn btn-default {nextDisabled} btn"},
                    new {sortOrder = ViewBag.CurrentSort, page = Model.PageIndex + 1, currentFilter = ViewBag.CurrentFilter, @class = $"btn btn-default {nextDisabled} btn"})
            </td>
        </tr>
    </table>


